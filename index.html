<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Widget API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["javascript"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://widgetworks.com.au'>Widget Works - Engage. Inform. Convert</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id='widget-works-widget-api'>Widget Works Widget API</h1><h2 id='data-in-data-out-dido-api'>Data In, Data Out (dido) API</h2>
<blockquote>
<p>All Widget Works Widgets provide an interaction API.</p>
</blockquote>

<p>Once a widget is placed on a page using the Widget Manager provided license and links, you can use our simple API to set and get calculatin specific data from the widget. The Widget itself runs in the iframe and you can&rsquo;t communicate to it directly due to cross domain limitations. Our helpful scout provides a secure, cross-frame communications API which you can use to query the Widget.</p>

<p>The API is event based and asynchronous:</p>

<blockquote>
<p>The namespace for all Widget Works API libraries is : <code class="prettyprint">wiwo</code></p>
</blockquote>

<ul>
<li>use our <code class="prettyprint">wiwo.iframeUtil</code> to create event listeners for <code class="prettyprint">wiwo.dido.getDataResult</code> or <code class="prettyprint">wiwo.dido.setDataResult</code> with your callbacks to take action with the data returned</li>
<li>once the iframe has loaded, use <code class="prettyprint">wiwo.iframeUtil.postMessage</code> to fire a <code class="prettyprint">&#39;wiwo.dido.getData&#39;</code> or <code class="prettyprint">&#39;wiwo.dido.setData&#39;</code> event, with your data payload</li>
<li>the Widget recevies the postMessage and will internally process the event. Depending on the action, it may offer the user options to save data before continuing</li>
<li>once ready, the Widget will fire a <code class="prettyprint">&#39;wiwo.dido.getDataResult&#39;</code> or <code class="prettyprint">&#39;wiwo.dido.setDataResult&#39;</code> via iframeUtil for your listener to be invoked</li>
</ul>

<p>In most cases the response from the Widget will be virtually immediate. Responses always provide:</p>

<ul>
<li>an <em>event result object</em> : failure/success, and details of any errors</li>
<li>a <em>data object</em> : actual data from the widget, calculation results, etc. <em>Refer to your Widget specific documentation for the data properties.</em></li>
</ul>
<h2 id='page-setup'>Page setup</h2>
<blockquote>
<p>To add a Widget to your page</p>
</blockquote>
<pre class="highlight html"><span class="c">&lt;!-- Start Widget Works - do not change --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"https://w.widgetworks.com.au/s/bojumo.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
 <span class="nt">&lt;iframe</span> <span class="na">id=</span><span class="s">"wiwo-bojumo"</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">height=</span><span class="s">"100"</span> <span class="na">src=</span><span class="s">""</span> <span class="na">frameborder=</span><span class="s">"0"</span> <span class="na">data-wiwo-init=</span><span class="s">"false"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"//s3-ap-southeast-2.amazonaws.com/w-widgetworks-com-au/widget/widget-scout.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="c">&lt;!-- End Widget Works --&gt;</span>
</pre>

<p>First, copy and insert the Widget embed code from <a href="https://wm.widgetworks.com.au">Widget Manager</a>. Our examples will use the following Mortgage Repayment Widget:</p>

<p>You can have multiple Widgets on the same page, just use the iframe id to refer to each instance specifically.</p>

<p><aside class="notice">
The iframe id (<em>wiwo-bojumo</em> in this case) identifies your license and the iframe itself.
</aside></p>

          <h1 id='the-api'>The API</h1><h2 id='available-messages'>Available messages</h2>
<blockquote>
<p>getData and setData - easy as that!</p>
</blockquote>
<pre class="highlight javascript">  <span class="nx">jQuery</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">'wiwo-bojumo'</span><span class="p">,</span> <span class="s1">'wiwo.dido.getData'</span><span class="p">);</span>
    <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">'wiwo-bojumo'</span><span class="p">,</span> <span class="s1">'wiwo.dido.setData'</span><span class="p">);</span>
  <span class="p">)};</span>
</pre>

<table><thead>
<tr>
<th>Message</th>
<th>Function</th>
</tr>
</thead><tbody>
<tr>
<td>wiwo.dido.getData</td>
<td>queues a request to get data from the specified widget</td>
</tr>
<tr>
<td>wiwo.dido.setData</td>
<td>queues a request to set your data payload on the specified widget</td>
</tr>
</tbody></table>

<p>To invoke actions on the Widget, use <code class="prettyprint">wiwo.iframeUtil.postMessage</code>. Ensure you wrap any of these calls in <code class="prettyprint">jQuery(function(){})</code> to ensure <code class="prettyprint">wiwo.iframeUtil</code> is ready and that the Widget has fully loaded and waiting for your messages.</p>
<h2 id='response-events'>Response events</h2>
<table><thead>
<tr>
<th>Event</th>
<th>Result</th>
</tr>
</thead><tbody>
<tr>
<td>&lsquo;wiwo.dido.getDataResult&rsquo;</td>
<td>result object with <code class="prettyprint">result.data.output</code> and <code class="prettyprint">result.data.input</code></td>
</tr>
<tr>
<td>&lsquo;wiwo.dido.setDataResult&rsquo;</td>
<td>result object with <code class="prettyprint">result.data.input</code>, the values you called setData with</td>
</tr>
</tbody></table>

<p>All event listeners and callbacks need to be setup in the context of <code class="prettyprint">wiwo.iframeUtil_config.ready</code>, which ensures your functions are only run once the Widget has fully loaded.</p>
<h2 id='event-properties'>Event Properties</h2>
<blockquote>
<p>Your returned data will be in an object like this</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"wiwoEvent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string - the name of the event"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"frameId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string - id of the frame that raised the event"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"frame"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iframe element - DOM reference to the frame that raised the event"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<table><thead>
<tr>
<th>Property</th>
<th>Details</th>
</tr>
</thead><tbody>
<tr>
<td>event.wiwoEvent</td>
<td>string - the name of the event</td>
</tr>
<tr>
<td>event.frameId</td>
<td>string - id of the frame that raised the event</td>
</tr>
<tr>
<td>event.frame</td>
<td>iframe element - DOM reference to the frame that raised the event</td>
</tr>
</tbody></table>
<pre class="highlight javascript"><span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil_config</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iframeUtil</span><span class="p">){</span>
    <span class="nx">iframeUtil</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'wiwo.dido.getDataResult'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">result</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">success</span><span class="p">){</span>
            <span class="c1">//your data handling here
</span>            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">output</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">//your error handling here
</span>            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error getting data: '</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre>
<h2 id='helpers'>Helpers</h2><pre class="highlight javascript"><span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil</span><span class="p">.</span><span class="nx">getFrameList</span><span class="p">()</span>

<span class="c1">// returns
</span>
<span class="p">[</span>
  <span class="p">{</span>
    <span class="na">frameId</span><span class="p">:</span> <span class="nx">string</span> <span class="o">-</span> <span class="nx">name</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">frame</span>
    <span class="na">frame</span><span class="p">:</span> <span class="nx">DOM</span> <span class="nx">element</span> <span class="nx">reference</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">frame</span> <span class="nx">itself</span>
  <span class="p">},</span>
  <span class="p">{...}</span>
<span class="p">]</span>
</pre>

<p><code class="prettyprint">wiwo.iframeUtil.getFrameList()</code> returns a list of all the Widget frames it knows about on a page.</p>
<h2 id='get-data-from-widget'>Get data from widget</h2><pre class="highlight javascript">  <span class="s2">"result"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"data"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"output"</span><span class="p">:</span> <span class="p">{</span>       
        <span class="s2">"repaymentResultModel"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"hasFixedRepayment"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
          <span class="s2">"fixedRepayment"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s2">"ongoingRepayment"</span><span class="p">:</span> <span class="mf">690.911525212645</span><span class="p">,</span>
          <span class="s2">"totalInterestPayable"</span><span class="p">:</span> <span class="mf">89094.6689249568</span><span class="p">,</span>
          <span class="s2">"totalLoanAmount"</span><span class="p">:</span> <span class="mf">189094.66892495676</span><span class="p">,</span>
          <span class="s2">"loanDuration"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"rawPeriods"</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
            <span class="s2">"totalYears"</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="s2">"years"</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="s2">"periods"</span><span class="p">:</span> <span class="mi">0</span>
          <span class="p">},</span>
          <span class="s2">"chartSeries"</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">"lastTerm"</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
              <span class="s2">"repaymentSeries"</span><span class="p">:</span> <span class="p">[</span>
                  <span class="p">[</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="mf">189094.67</span>
                  <span class="p">]</span>
                  <span class="c1">//, ....
</span>              <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>       

      <span class="p">},</span>
      <span class="s2">"input"</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">//all the input fields
</span>      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre>

<p><code class="prettyprint">getData</code> will return you a <code class="prettyprint">result</code> with two primary objects, the <em>standard input fields</em> under <code class="prettyprint">data.input</code> and the <em>calculation results</em> under <code class="prettyprint">data.output</code>. You can modify the input fields and send it right back for recalculation via <code class="prettyprint">setData</code>.</p>

<p>You can call <code class="prettyprint">getData</code> at any time. Widgets aim to always be in a consistent state - even if they have to rely on default input values. Internal calculations are always attempted before the <code class="prettyprint">getData</code> request is fulfilled.</p>

<blockquote>
<p>Putting it all together</p>
</blockquote>
<pre class="highlight javascript">    <span class="c1">//setup your event listeners, which will receive data in result
</span>    <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil_config</span> <span class="o">=</span> <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil_config</span> <span class="o">||</span> <span class="p">{};</span> <span class="c1">//manual namespace in case the support script haven't loaded yet
</span>    <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil_config</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iframeUtil</span><span class="p">){</span>
      <span class="nx">iframeUtil</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'wiwo.dido.getDataResult'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">result</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">success</span><span class="p">){</span>
          <span class="c1">//all result.data.input and result.data.output is available to you
</span>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"You will pay a total of %d interest for the loan"</span><span class="p">,</span>
            <span class="nx">result</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">repaymentResultModel</span><span class="p">.</span><span class="nx">totalInterestAmt</span>
          <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">//handle the error
</span>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error getting data: '</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="cm">/** 
     * Once the page is ready (which will ensure the Widget is ready and listening too),
     * send a getData request. Once it's fulfilled, a 'wiwo.dido.getDataResult' will be 
     * raised and your listener above will be invoked
     */</span>
    <span class="nx">jQuery</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="c1">// Need to make sure the frame content has been loaded. 
</span>      <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">'wiwo-bojumo'</span><span class="p">,</span> <span class="s1">'wiwo.dido.getData'</span><span class="p">);</span>
    <span class="p">});</span>

</pre>
<h2 id='set-data-on-the-widget'>Set data on the widget</h2>
<blockquote>
<p>The data payload you send must follow the input.modelName format style that is returned from a getData:</p>
</blockquote>
<pre class="highlight javascript"><span class="kd">var</span> <span class="nx">myData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">input</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">modelName</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">property</span><span class="p">:</span> <span class="nx">value</span>
            <span class="c1">// ...
</span>        <span class="p">},</span>
        <span class="na">modelName</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// ...
</span>        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre>
<pre class="highlight javascript">
    <span class="c1">//setup your event listeners, which will receive data in result
</span>    <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil_config</span> <span class="o">=</span> <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil_config</span> <span class="o">||</span> <span class="p">{};</span> <span class="c1">//manual namespace in case the support script haven't loaded yet
</span>    <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil_config</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iframeUtil</span><span class="p">){</span>
      <span class="nx">iframeUtil</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'wiwo.dido.setDataResult'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">result</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">success</span><span class="p">){</span>
          <span class="c1">//all result.data.input and result.data.output is available to you
</span>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Your data was set, run getData to get the calc results"</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="c1">//handle the error
</span>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Error getting data: '</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="cm">/** 
     * Once the page is ready (which will ensure the Widget is ready and listening too),
     * send a setData request with your payload. Once it's fulfilled, 
     * a 'wiwo.dido.setDataResult' will be 
     * raised and your listener above will be invoked
     */</span>
    <span class="nx">jQuery</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="c1">// Need to make sure the frame content has been loaded.       
</span>      <span class="kd">var</span> <span class="nx">myData</span> <span class="o">=</span> <span class="p">{</span> 
        <span class="na">input</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">repaymentModel</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">principle</span><span class="p">:</span> <span class="mi">150000</span><span class="p">,</span>
            <span class="na">rate</span><span class="p">:</span> <span class="mf">0.065</span>
            <span class="c1">// ...
</span>          <span class="p">},</span> 
          <span class="na">savingsModel</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1">// ...
</span>          <span class="p">}</span>
        <span class="p">}</span>       
      <span class="p">};</span>      
      <span class="nx">wiwo</span><span class="p">.</span><span class="nx">iframeUtil</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">'wiwo-bojumo'</span><span class="p">,</span> <span class="s1">'wiwo.dido.setData'</span><span class="p">,</span> <span class="nx">myData</span><span class="p">);</span>      
    <span class="p">});</span>

</pre>

<p>Using setData, you provide an object to the widget with all the of the standard input fields. Any input field which is usually provided on screen can be set on via the API. Refer to your Widget specific documentation for the input object model.</p>

          <h1 id='error-handling'>Error Handling</h1>
<p>Widgets do their best to keep in a consistent state and ensure they don&rsquo;t show complex or code related errors to users. We design them to accept a wide range of inputs, but to ensure accuracy they are conservative in their approach to error handling - they will reject data on error and provide you a result object detailing what went wrong.</p>

<p><aside class="notice">Widgets do their best to keep in a consistent state and ensure they don&rsquo;t show complex or code related errors</aside></p>
<h2 id='data-issues'>Data issues</h2>
<p>Widgets pre-process all input data and perform type conversion and internal lookups before calculating or displaying the data you give them. If lookups are invalid or outdated (eg. when you try to look up an outdated product) the widget will log errors and return the error information in the result object.</p>

<p>Most of the time you will still get a calculation value back from <code class="prettyprint">getDataResult</code>, but it will use internal defaults for fields with errors.</p>
<h2 id='missing-required-data'>Missing required data</h2>
<p>Required values that are not supplied will be logged to console and in the result object.</p>
<h2 id='invalid-datatypes'>Invalid datatypes</h2>
<p>Simply rejected</p>
<h2 id='outdatedinvalid-lookup-references-ie-product-names'>Outdated/invalid lookup references (ie Product names)</h2>
<p>You control all product information and settings from your Widget Manager account so you must ensure you keep any external references to product keys up to date. If you try and set data with references to a product which doesn&rsquo;t exist the Widget will either default to the first applicable in the list or reject your set data.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
